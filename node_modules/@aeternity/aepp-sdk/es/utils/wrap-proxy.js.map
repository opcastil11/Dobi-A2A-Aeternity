{"version":3,"file":"wrap-proxy.js","names":["ArgumentError","wrapWithProxy","valueCb","Proxy","Object","fromEntries","map","name","t","args","target","res","Reflect","bind","unwrapProxy","value","_wrappedValue"],"sources":["../../src/utils/wrap-proxy.ts"],"sourcesContent":["import { ArgumentError } from './errors.js';\n\nexport function wrapWithProxy<Value extends object | undefined>(\n  valueCb: () => Value,\n): NonNullable<Value> {\n  return new Proxy(\n    {},\n    Object.fromEntries(\n      (\n        [\n          'apply',\n          'construct',\n          'defineProperty',\n          'deleteProperty',\n          'getOwnPropertyDescriptor',\n          'getPrototypeOf',\n          'isExtensible',\n          'ownKeys',\n          'preventExtensions',\n          'set',\n          'setPrototypeOf',\n          'get',\n          'has',\n        ] as const\n      ).map((name) => [\n        name,\n        (t: {}, ...args: unknown[]) => {\n          const target = valueCb();\n          if (target == null) throw new ArgumentError('wrapped value', 'defined', target);\n          if (name === 'get' && args[0] === '_wrappedValue') return target;\n          const res = (Reflect[name] as any)(target, ...args);\n          return typeof res === 'function' && name === 'get' ? res.bind(target) : res;\n        },\n      ]),\n    ),\n  ) as NonNullable<Value>;\n}\n\nexport function unwrapProxy<Value extends object>(value: Value): Value {\n  return (value as { _wrappedValue?: Value })._wrappedValue ?? value;\n}\n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,aAAa;AAE3C,OAAO,SAASC,aAAaA,CAC3BC,OAAoB,EACA;EACpB,OAAO,IAAIC,KAAK,CACd,CAAC,CAAC,EACFC,MAAM,CAACC,WAAW,CAEd,CACE,OAAO,EACP,WAAW,EACX,gBAAgB,EAChB,gBAAgB,EAChB,0BAA0B,EAC1B,gBAAgB,EAChB,cAAc,EACd,SAAS,EACT,mBAAmB,EACnB,KAAK,EACL,gBAAgB,EAChB,KAAK,EACL,KAAK,CACN,CACDC,GAAG,CAAEC,IAAI,IAAK,CACdA,IAAI,EACJ,CAACC,CAAK,EAAE,GAAGC,IAAe,KAAK;IAC7B,MAAMC,MAAM,GAAGR,OAAO,CAAC,CAAC;IACxB,IAAIQ,MAAM,IAAI,IAAI,EAAE,MAAM,IAAIV,aAAa,CAAC,eAAe,EAAE,SAAS,EAAEU,MAAM,CAAC;IAC/E,IAAIH,IAAI,KAAK,KAAK,IAAIE,IAAI,CAAC,CAAC,CAAC,KAAK,eAAe,EAAE,OAAOC,MAAM;IAChE,MAAMC,GAAG,GAAIC,OAAO,CAACL,IAAI,CAAC,CAASG,MAAM,EAAE,GAAGD,IAAI,CAAC;IACnD,OAAO,OAAOE,GAAG,KAAK,UAAU,IAAIJ,IAAI,KAAK,KAAK,GAAGI,GAAG,CAACE,IAAI,CAACH,MAAM,CAAC,GAAGC,GAAG;EAC7E,CAAC,CACF,CACH,CACF,CAAC;AACH;AAEA,OAAO,SAASG,WAAWA,CAAuBC,KAAY,EAAS;EAAA,IAAAC,aAAA;EACrE,QAAAA,aAAA,GAAQD,KAAK,CAA+BC,aAAa,cAAAA,aAAA,cAAAA,aAAA,GAAID,KAAK;AACpE","ignoreList":[]}