{"version":3,"file":"MiddlewareSubscriber.js","names":["WebSocket","BaseError","UnexpectedTsError","InternalError","Source","MiddlewareSubscriberError","constructor","message","name","MiddlewareSubscriberDisconnected","closeEvent","_subscriptions","WeakMap","_requestQueue","_webSocket","_MiddlewareSubscriber_brand","WeakSet","MiddlewareSubscriber","webSocket","_classPrivateFieldGet","url","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","reconnect","_assertClassBrand","_disconnect","call","_classPrivateFieldSet","Promise","resolve","Object","assign","onopen","onerror","errorEvent","_emit","undefined","error","onmessage","event","data","_messageHandler","JSON","parse","onclose","all","_classPrivateGetter","_get_targets","map","target","_sendSubscribe","subscribeKeyBlocks","cb","_subscribe","Middleware","subscribeKeyBlocksNode","Node","subscribeKeyBlocksAll","All","subscribeMicroBlocks","subscribeMicroBlocksNode","subscribeMicroBlocksAll","subscribeTransactions","subscribeTransactionsNode","subscribeTransactionsAll","subscribeObject","subscribeObjectNode","subscribeObjectAll","_this","Set","_sendMessage","send","stringify","isSubscribe","payload","includes","op","push","condition","p","e","filter","source","forEach","onlyReset","close","Array","isArray","request","shift","t","subscription","size","has","item"],"sources":["../src/MiddlewareSubscriber.ts"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nimport WebSocket from 'isomorphic-ws';\nimport { BaseError, UnexpectedTsError, InternalError } from './utils/errors.js';\nimport { Encoded } from './utils/encoder.js';\n\ninterface Message {\n  payload: Object;\n  source: Source.Middleware | Source.Node;\n  subscription: 'KeyBlocks' | 'MicroBlocks' | 'Transactions' | 'Object';\n  target?: string;\n}\n\nenum Source {\n  Middleware = 'mdw',\n  Node = 'node',\n  All = 'all',\n}\n\nexport class MiddlewareSubscriberError extends BaseError {\n  constructor(message: string) {\n    super(message);\n    this.name = 'MiddlewareSubscriberError';\n  }\n}\n\nexport class MiddlewareSubscriberDisconnected extends MiddlewareSubscriberError {\n  constructor(readonly closeEvent: WebSocket.CloseEvent) {\n    super('Connection closed');\n    this.name = 'MiddlewareSubscriberDisconnected';\n  }\n}\n\n/**\n * @category middleware\n */\nexport default class MiddlewareSubscriber {\n  #subscriptions: Array<readonly [target: string, s: Source, cb: (p?: Object, e?: Error) => void]> =\n    [];\n\n  readonly #requestQueue: Array<[isSubscribe: boolean, target: string]> = [];\n\n  #webSocket?: WebSocket;\n\n  get webSocket(): WebSocket | undefined {\n    return this.#webSocket;\n  }\n\n  get #targets(): Set<string> {\n    return new Set(this.#subscriptions.map(([target]) => target));\n  }\n\n  #sendMessage(message: any): void {\n    if (this.#webSocket == null) throw new UnexpectedTsError();\n    this.#webSocket.send(JSON.stringify(message));\n  }\n\n  #sendSubscribe(isSubscribe: boolean, target: string): void {\n    if (this.#webSocket == null) return;\n    const payload = ['KeyBlocks', 'MicroBlocks', 'Transactions'].includes(target)\n      ? target\n      : 'Object';\n    this.#sendMessage({\n      op: isSubscribe ? 'Subscribe' : 'Unsubscribe',\n      payload,\n      ...(payload === 'Object' && { target }),\n    });\n    this.#requestQueue.push([isSubscribe, target]);\n  }\n\n  #emit(condition: (target: string, source: Source) => boolean, p?: Object, e?: Error): void {\n    this.#subscriptions\n      .filter(([target, source]) => condition(target, source))\n      .forEach(([, , cb]) => cb(p, e));\n  }\n\n  constructor(readonly url: string) {}\n\n  #disconnect(onlyReset = false): void {\n    if (this.#webSocket == null) return;\n    if (!onlyReset) this.#webSocket.close();\n    Object.assign(this.#webSocket, {\n      onopen: undefined,\n      onerror: undefined,\n      onmessage: undefined,\n    });\n    this.#webSocket = undefined;\n  }\n\n  async reconnect(): Promise<void> {\n    this.#disconnect();\n    this.#webSocket = await new Promise((resolve) => {\n      const webSocket = new WebSocket(this.url);\n      Object.assign(webSocket, {\n        onopen: () => resolve(webSocket),\n        onerror: (errorEvent: WebSocket.ErrorEvent) => {\n          this.#emit(() => true, undefined, errorEvent.error);\n        },\n        onmessage: (event: WebSocket.MessageEvent) => {\n          if (typeof event.data !== 'string') {\n            throw new InternalError(`Unknown incoming message type: ${typeof event.data}`);\n          }\n          this.#messageHandler(JSON.parse(event.data));\n        },\n        onclose: (event: WebSocket.CloseEvent) => {\n          this.#emit(() => true, undefined, new MiddlewareSubscriberDisconnected(event));\n          this.#disconnect(true);\n        },\n      });\n    });\n    await Promise.all([...this.#targets].map((target) => this.#sendSubscribe(true, target)));\n  }\n\n  #messageHandler(message: string | string[] | Message): void {\n    if (typeof message === 'string' || Array.isArray(message)) {\n      const request = this.#requestQueue.shift();\n      if (request == null) throw new InternalError('Request queue is empty');\n      const [isSubscribe, target] = request;\n      let error;\n      if (typeof message === 'string') error = new MiddlewareSubscriberError(message);\n      if (message.includes(target) !== isSubscribe) {\n        error = new InternalError(\n          `Expected ${target} to be${isSubscribe ? '' : ' not'} included into ${message}`,\n        );\n      }\n      if (error != null) this.#emit((t) => target === t, undefined, error);\n      return;\n    }\n    this.#emit(\n      (target, source) =>\n        (target === message.subscription || target === message.target) &&\n        (source === message.source || source === Source.All),\n      message.payload,\n    );\n  }\n\n  #subscribe(target: string, source: Source, cb: (p?: Object, e?: Error) => void): () => void {\n    const subscription = [target, source, cb] as const;\n    if (this.#targets.size === 0) this.reconnect();\n    if (!this.#targets.has(target)) this.#sendSubscribe(true, target);\n    this.#subscriptions.push(subscription);\n    return () => {\n      this.#subscriptions = this.#subscriptions.filter((item) => item !== subscription);\n      if (!this.#targets.has(target)) this.#sendSubscribe(false, target);\n      if (this.#targets.size === 0) this.#disconnect();\n    };\n  }\n\n  // TODO: replace p?: any with a proper type definition\n\n  subscribeKeyBlocks(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('KeyBlocks', Source.Middleware, cb);\n  }\n\n  subscribeKeyBlocksNode(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('KeyBlocks', Source.Node, cb);\n  }\n\n  subscribeKeyBlocksAll(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('KeyBlocks', Source.All, cb);\n  }\n\n  subscribeMicroBlocks(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('MicroBlocks', Source.Middleware, cb);\n  }\n\n  subscribeMicroBlocksNode(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('MicroBlocks', Source.Node, cb);\n  }\n\n  subscribeMicroBlocksAll(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('MicroBlocks', Source.All, cb);\n  }\n\n  subscribeTransactions(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('Transactions', Source.Middleware, cb);\n  }\n\n  subscribeTransactionsNode(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('Transactions', Source.Node, cb);\n  }\n\n  subscribeTransactionsAll(cb: (p?: any, e?: Error) => void): () => void {\n    return this.#subscribe('Transactions', Source.All, cb);\n  }\n\n  subscribeObject(\n    target:\n      | Encoded.KeyBlockHash\n      | Encoded.Channel\n      | Encoded.ContractAddress\n      | Encoded.OracleAddress\n      | Encoded.OracleQueryId\n      | Encoded.AccountAddress\n      | Encoded.Name\n      | `${string}.chain`,\n    cb: (p?: any, e?: Error) => void,\n  ): () => void {\n    return this.#subscribe(target, Source.Middleware, cb);\n  }\n\n  subscribeObjectNode(\n    target:\n      | Encoded.KeyBlockHash\n      | Encoded.Channel\n      | Encoded.ContractAddress\n      | Encoded.OracleAddress\n      | Encoded.OracleQueryId\n      | Encoded.AccountAddress\n      | Encoded.Name\n      | `${string}.chain`,\n    cb: (p?: any, e?: Error) => void,\n  ): () => void {\n    return this.#subscribe(target, Source.Node, cb);\n  }\n\n  subscribeObjectAll(\n    target:\n      | Encoded.KeyBlockHash\n      | Encoded.Channel\n      | Encoded.ContractAddress\n      | Encoded.OracleAddress\n      | Encoded.OracleQueryId\n      | Encoded.AccountAddress\n      | Encoded.Name\n      | `${string}.chain`,\n    cb: (p?: any, e?: Error) => void,\n  ): () => void {\n    return this.#subscribe(target, Source.All, cb);\n  }\n}\n"],"mappings":"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","ignoreList":[]}